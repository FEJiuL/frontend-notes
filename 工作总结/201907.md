 //工作总结

### 1.rem下html fontSize 值计算

> const ps_width = 1920;           //设计稿宽度  <br />
> const view_width                 //屏幕宽度  <br />
> const baseFontSize = 100         //1920设计稿下fontSize(取值100方便 px -> rem 单位换算)  <br />
> const ratio = view_width / ps_width <br />
> 计算公式：fontSize = ratio * baseFontSize （单位：px）<br />

> 结合vw单位可以实现resize后自动调整fontSize值。<br />
> 计算公式: <br />
> 计算1vw对应的像素值：const 1vw = ps_width / 100; <br />
> fontSize = ratio * baseFontSize / 1vw (单位：vw) <br />

提升效率工具：开发的时候引入(px2rem-loader | postcss-px2rem),如果使用了styled-component替换成styled-px2rem。则我们在开发阶段就可以直接使用设计稿测量得到的值写css样式，转换的工作交由webpack完成。

### 2.前端运行错误报告

> * 监听全局的onerror事件，但只能获取到未被cathy的错误信息。 <br >
> * 主要上报内容为错误信息(msg)，错误所在文件(file),行（line），列（col），错误堆栈（stack），时间（time），ua。 <br >
> * 获取到以上信息，结合map文件可以更快速的定位到问题。
```javascript
/**
 * ==== 用户端全局错误捕获事件 ====
 */
const errorReport = () => 
  const maxCount = 100 //最大上报次数
  let count = 0,
    ua = window.navigator.userAgent
  window.onerror = (msg, file, line, col, err) => {
    if (++count > maxCount) return
    const time = +new Date() //用户系统时间
    const stack = err.stack //错误js堆栈
    const report = {msg, file, line, col, stack, time, ua} //错误上报报文
    let img = document.createElement('img')
    img.src = `http://report.example.com/report/error?data=${
      encodeURIComponent(JSON.stringify(report))
    }`
    img.onload = img.onerror = () => (img = null)
    return true
  }
  return ''
}
```
> nginx server 配置
```c++
server{
	listen 80;
	server_name report.example.com;
	
	#日志配置
	access_log  logs/report.access.log  main;

	#前端报告收集
	location ~* /report/{
		return 200 'ok';
	}
}

```

### 3.前端首屏加载时长报告
> * 通过浏览器提供的timing信息可以分析出部分加载缓慢的原因。
> * loadEventStart为onload函数开始执行时间，navigationStart为浏览器unload前一个页面文档的开始时间节点
> * 这里在设置个阈值threshold，减少低于阈值的报告数据,如要收集所有的，把阈值设为0即可。
```javascript
/**
* ==== 首屏加载性能报告 ====
* @param {number} threshold
*/
const performanceReport = (threshold = 1000) => {
  window.onload = () => {
    setTimeout(() => {
      const report = window.performance;
      const {loadEventStart, navigationStart} = report.timing;
      if(loadEventStart, navigationStart > threshold){
      	let img = document.createElement('img');
	img.src = `http://report.example.com/report/error?data=${
	  encodeURIComponent(JSON.stringify(report))
	}`;
	img.onload = img.onerror = (img = null)
      }
    }, 0)
  }
}
